---
title: "ASICS package"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ASICS package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette provides an overview of the package ASICS. ASICS is a completely 
automated procedure to identify and quantify metabolites in 1H NMR spectra of 
biological mixtures. It will enable empowering NMR-based metabolomics by quickly 
and accurately helping experts to obtain metabolic profiles.

```{r}
library(ASICS)
```

## Library of pure NMR spectra

A dataset with spectra of 175 pure metabolites are available.

Data are loaded and available metabolite are displayed with:
```{r lib}
data(pure_library)
pure_library$name
```

## Quantification of one or more Bruker files with ASICS

It is possible to perform the quantification with only one function directly 
from raw files (Bruker files):
```{r ASICS_onefile}
result <- ASICS(path = system.file("extdata", "example_spectra",
                                   "AG_faq_Beck01", package = "ASICS"),
                exclusion.areas = matrix(c(4.5,5.1,5.5,6.5),
                                         ncol = 2, byrow = TRUE),
                max.shift = 0.02, which.spectra = "last",
                library.metabolites = NULL, threshold.noise = 0.02)
```

We can judge the quality of the quantification by stacking the original and the 
recomposed spectrum. Pure metabolites spectrum can also be added.
```{r plot_spectrum, warning=FALSE, fig.width=10, fig.height=6}
plot_spectrum(result, xmin = 1, xmax = 1.5, ymax = 10, add_metab = "Lactate")
```

Relative concentrations of identified metabolites are saved in:
```{r rel_conc}
result$Present
```

Usually, many spectra are available for one experience. With the following 
function, quantification is lauched on all spectra present in a folder 
(possibly in parallel):
```{r ASICS_multifile, results='hide'}
res_multi <- ASICS_multiFiles(name.dir = system.file("extdata",
                                                     "example_spectra",
                                                     package = "ASICS"),
                              exclusion.areas = matrix(c(4.5,5.1,5.5,6.5),
                                                       ncol = 2, byrow = TRUE),
                              max.shift = 0.02, which.spectra = "last",
                              library.metabolites = NULL,
                              threshold.noise = 0.02, ncores = 4)
```

For further analysis, it is possible to extract concentrations of all spectra in
a data-frame:
```{r extract_concentrations}
quantification <- extract_concentrations(res_multi)
head(quantification)
```



